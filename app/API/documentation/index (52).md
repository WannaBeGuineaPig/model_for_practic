# Вкладка «Входящие документы»

Для настройки нужно в Меню в поисковой строке ввести - "Настройка параметров обмена с 1С*".

Данная вкладка предназначена для описания настроек по документам, забираемых из 1С, например: «Документ на подписание», «Документ в Лексеме» .

При первом входе в документ, табличная часть вкладки «Входящие документы» будет пред заполнена.

В зависимости от того, на каком «Типе» строк вызывается справочник – для выбора будет соответствующий набор данных.

Например, для Подтипа документа на подписание  будут подтипы из «Конструктора документов» с типом «Документ на подписание»:
![alt text](media/image.png)
![alt text](media/image-1.png)

Для документов на подписание, с одной сущностью 1С необходимо настроить загрузку в разные подтипы документов:

![alt text](media/image-2.png)

В параметр для запроса сущности в 1С при этом пишем идентификатор, который отличит эти типы документов, например,
```json
?$filter=ДополнительныеОтпуска/ВидОтпуска_Key eq guid'cf447156-eb49-11e8-5f86-005056ab6485' and Date gt datetime'2022-07-01T00:00:00' 
```

В документы на подписание также можно забирать печатные формы, прикрепляемые к документу "Сотрудники" в 1С:

![alt text](media/image-3.png)

Для этого в поле **"Условие наличия отчета в 1С"** пишем название отчета, который является признаком готовности забрать  комплект печатных форм, описанных в колонке **"Наименование отчетов в 1С для загрузки"** во вложения к документу.
Например,  
**"Условие наличия отчета в 1С"** = Комплект документов при приеме
**"Наименование отчетов в 1С для загрузки"** = Комплект документов при приеме;Личная карточка (Т-2)

![alt text](media/image-4.png)

Для указания параметров загрузки документов и вложений с типом «Дата» введены следующие переменные:

-  `{{LastDay}}` – переменная для определения количества дней, за которое нужно выбрать данные для загрузки. Значение задается в настройках учетной политики в  константе **"ЗаСколькоПоследнихДнейЗагружатьДокументыИз1С"**.
Например,
```json
?$filter=Date gt datetime'{{LastDay}}'
```
со значением константы 10 – за последние 10 дней будут загружаться данные

- `{{FirstDayMonth}}` – переменная для определения даты, до которой нужно загружать документы  прошлого месяца. Значение задается в настройках учетной политики в  константе **"ДоКакогоЧислаЗагружатьДокументыИз1С_ЗаПрошлыйМесяц"**.
Например,
```json
?$filter=Date gt datetime'{{ FirstDayMonth }}'
```
со значением константы 15 – до 15.12.22 будут загружаться данные с 01.12.22

- `{{YesterDay}}` – переменная, обозначающая предыдущий день от текущего.
Например, 
```json
?$filter=ДатаСоздания ge datetime'{{YesterDay}}'
``` 
– если сегодня 15.12.22, то документы для загрузки будут выбраны за 14.12.22

Столбец **"Дата начала проверки отчетов по кодам (guid-ам)"**. В нужной строке указывается дата и документы с заданными сущностями и параметрами, отчеты которых будут загружаться каждый раз, когда в 1С будут вкладывать новые отчеты. Без отчетов такие документы грузиться не будут, даже если "Условие наличия отчета" - пусто.

В случае если необходимо в один документ на подписание вложить два отчета, то необходимо в столбец **"Наименования отчетов в 1С для для загрузки во вложения к документу"** то через двоеточие указывать название второго отчета. Если в данном столбце указано одно либо несколько наименований отчета, то при выгрузке из 1С данный документ будет отмечен как главный документ. Если указаны несколько наименований отчетов, но в 1С отсутствует отчет с первым названием, но присутствуют другие, то "главным" проставляется тот отчет, у которого наименьшая датой создания. Такое же правильно распространяется в случае если данное поле незаполнено никакими наименованиями. [Главный документ](httphttps://ecm-user-manuals.readthedocs.io/ru/latest/User%20manuals/Работа%20со%20вложениями/#архив_документов), согласно определению Минтруда, указывает на основной электронный документ и помогает определить все остальные файлы как пояснительные документы.

В случае если необходимо загружать только документы для сотрудников с датой перехода на КЭДО, необходимо для таких видов проставить галку в столбце **"Загружать только для сотрудников с датой перехода на КЭДО"**.

Для загрузки трудовых договоров сотрудников необходимо добавить строку с типом **"Документ в Лексеме"** с наименованием **"RP_WorkContractForm"** и сущностью 1С **"Document_ПриемНаРаботу"**.

## Документ на подписание

Документ на подписание может быть создан в СЭД из Заявления сотрудников, либо быть не связанным с Заявлением документом, для которого необходимо пройти процедуру согласования в СЭД.

Поле **«Наименование документа»** должно быть одинаковым на вкладках «Исходящие документы» и «Входящие документы», относящимся к одной сущности 1С, в том случае, если *необходимо забирать из 1С документы, которые созданы на основании Заявлений из СЭД*. 
Если же необходимо забирать  *документы указанной сущности 1С, не связанных с  Заявлениями из СЭД*, то в строке «Подтип документа на подписание» на вкладке «Входящие документы» необходимо указать «Наименование документа», отличное от  закладки «Исходящие документы».
Для каждого документа на подписание, обмен которыми планируется между системами, необходимо создать «Подтип документа» и оформить для него карточку «Конструктора документов».

![alt text](media/image-5.png)

**Справочник в Лексеме** – подтип из Конструктора документов для типа «Документ на подписание», который указан в поле Наименование документа.

**Наименование документа** – наименование документа, с которым  будет происходить обмен данными.

**Сущность в 1С** – сущность на стороне 1С для обмена данными. В этих строчках указываются параметры для передачи документов на подписание в 1С.

**Параметр для запроса сущности в 1С**

**Дополнительные условия к документу 1С** - условия   для загрузки документа в СЭД , например, для документа «Отпуск» - это
```json
{ "ПредоставитьОсновнойОтпуск": true, "ДокументРассчитан": true },
``` 
так как данный вид сущности должен быть рассчитан . А для отпуска без сохранения оплаты параметры будут заполнены следующим образом:
```json
{"ВидОтпуска_Key":"7601b82e-8584-11e2-9371-001b11b25590"}.
```
Определение параметров выполняется исходя из анализа сущности 1С.

**Наименование отчета в 1С** – наименование отчета в 1С, присоединенного к документу, наличие которого является обязательным условием для импорта документа из 1С в СЭД.

Например, для документа «Отпуск» – во вложении анализируется наличие  Приказа о предоставлении отпуска (Т-6). Если еще нет вложения, то приказ считается не удовлетворяющим условиям загрузки и не попадет в СЭД. Если в настройках наименование отчета не указано, то для импорта этого документа наличие какого-либо отчета не является необходимым условием и этот документ будет импортирован даже без единого отчета. При этом при импорте документов всегда забираются все вложения прикрепленные в 1С.

**Сущность вложения** – наименование сущности 1С, в которую необходимо передавать данные. Содержит перечень файлов – наименование, расширение, связка с документом в 1С, например, `Catalog_ОтпускПрисоединенныеФайлы`

**Сущность хранилища файлов** - промежуточная сущность в которой хранится связь между присоединенными файлами документа и самими двоичными данными файлов InformationRegister_ХранилищеФайлов, также необходимо `Catalog_ХранилищеДвоичныхДанных` прописать в Сущность двоичных данных файлов

**Сущность двоичных данных файлов** `InformationRegister_ДвоичныеДанныеФайлов`, сущность, в которой хранятся все файлы в двоичном представлении.
Существует два вида условий для выбора документов в 1С для формирования «Документа на подписание» в СЭД:

•	наличие во вложении отчета с определенным наименованием (например, для отпуска  - это отчет «Приказ о предоставлении отпуска (Т-6…». ) 
•	условия из поля «Параметры»  (например, для отпуска, статус ДокументРассчитан).

## Документ в Лексеме

Для настройки нужно выбрать в меню *группу Администрирование -> Система -> Настройка параметров обмена с 1С*.

Для загрузки документов 1С в документы, отличные от Документов на подписание, то есть физические документы СЭД предусмотрен блок настроек с типом  «Документ в Лексеме».

Отличием настроек от предыдущих документов является поле *«Порядок выполнения»* и *«Наименование документа»*.

**Порядок выполнения** – указывается по документам, для загрузки которых важна хронология этапов. Например, для документа «График отпусков» -  сначала необходимо загрузить *«График отпусков»*, затем *«Перенос отпуска»*:

![Рисунок 1 Документ_в_Лексеме](../media/Документ_в_Лексеме.png)  
 
**Наименование документа** – форма СЭД, например, «RP_VacationForm». 
**Сущность 1С** – наименование метаданных для загрузки в СЭД, например, Document_ГрафикОтпусков 
**Параметры** не заполняются, так как данные не передаются в 1С. 
**Сущность вложений** - сущность вложений файлов в 1С, из которой забираем данные. В ней хранится перечень файлов – наименование, расширение, связка с документом в 1С, например, Catalog_ ГрафикОтпусковПрисоединенныеФайлы 

**Сущность файла** InformationRegister_ДвоичныеДанныеФайлов, сущность 1С, в которой хранятся все файлы в двоичном представлении.  

## Настройка входящих документов


