# Настройка СЭД для администраторов

## Описание

В данной инструкции описаны настройки для документов системы электронного документооборота (далее-СЭД), например, такие документы как входящие, исходящие, организационно-распределительный документ (далее-ОРД), поручения и служебные записки (далее СЗ). Для каждой формы СЭД должны быть созданы:

* [Настройки документа](../Настройка документов/);
* [Подтипы документов](../Подтипы%20документов/)
* [Конструкторы документов](../Конструктор%20документов/), кроме документа **поручение**;
* [Шаблоны маршрутов](../Настройка шаблонов маршрутов/);
* [Журналы регистраций](../Журнал регистрации/).

Для работы с каждой формой необходимо настроить необходимые роли. О назначении ролей можно ознакомиться по ссылке [«редактирование пользователя»](../Управление пользователями/#редактирование_пользователя).

Также для каждой формы в системе присутствуют определенные дополнительные функции ([константы](../Настройка%20констант/index.md)).

Для отображения быстрых кнопок в панели инструментов должна быть настроена константа **toolbar_docflow_route_processing_buttons**

## Входящие документы

[Входящий документ](https://ecm-user-manuals.readthedocs.io/ru/latest/User%20manuals/%D0%92%D1%85%D0%BE%D0%B4%D1%8F%D1%89%D0%B8%D0%B9%20%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82/) служит для отображения данных по входящей корреспонденции организации.

Роль | Описание
-----|---------
**incomingdocument_read**  |  для просмотра и ознакомления с документом.
**incomingdocument_write**  |  для возможности редактирования документа.
**master_registrar** | позволяет назначать вручную регистрационный номер и дату регистрации документа.

Возможно использовать [вычисляемые атрибуты](../Конструктор документов/#вычисляемые_атрибуты)

**#Master_PrintedText#** - содержательная часть

**#Master_ReplyNumber#** - в ответ на входящий - номер документа

**#Master_ReplyDate#** - в ответ на входящий - дата документа

## Исходящие документы

[Исходящие документы](https://ecm-user-manuals.readthedocs.io/ru/latest/User%20manuals/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D1%8F%D1%89%D0%B8%D0%B9%20%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82/) - это оформление документов, которые написаны в индивидуальном порядке или в ответ на входящий документ.

Роль | Описание
-----|---------
**outgoingdocument_read**  |  для чтения и просмотра формы.
**outgoingdocument_write**  |  для редактирования формы.
**outgoing_registrar**  |  позволяет зарегистрировать документ.
**master_registrar**  |  позволяет вручную назначать регистрационный номер и дату регистрации документа.

Возможно использовать [вычисляемые атрибуты](../Конструктор документов/#вычисляемые_атрибуты)

**#Master_PrintedText#** - содержательная часть

**#Master_WhoseName#** - на чье имя (Ф.И.О.) в исходящем документе

Имеется константа:
  
**Авторегистрация_ИсхДок** - автоматическое присваивание номера исходящего документа на этапе "Зарегистрировать".

**Исходящие_Идентификатор_почты_для_отправки** - казывается идентификатор почтового ящика для отправки исходящего письма на почту контрагенту. В `production.js` в сервисе `post` указывается дополнительная почта.

`User` - логин от почты

`Pass` - пароль от почты

![alt text](media/image-3.png)

## ОРД

[ОРД](https://ecm-user-manuals.readthedocs.io/ru/latest/User manuals/%D0%9E%D0%A0%D0%94/#%D0%BE%D1%80%D0%B3%D0%B0%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE-%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D1%80%D1%8F%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B_%D0%BE%D1%80%D0%B4) – это документ для автоматизации документооборота организационно-распорядительных документов (приказы, протоколы, распоряжения) в организации.

Роль | Описание
-----|---------
**organizationaldocument_read**  |  для чтения и ознакомления с документом.
**organizationaldocument_write**  |  для редактирования документа.
**master_registrar**  |  позволяет вручную назначать регистрационный номер и дату регистрации документа.

Имеются константы:

- **Авторегистрация_ОРД** - автоматическое присваивание номера документа на этапе "Зарегистрировать"

- **servicerecord_with_signature** - в реестре документов «Служебная записка» и «ОРД» добавляется колонка с признаком подписания ЭП и изменяется печатная форма документа на шаблон со штампом электронной подписи.
  
- **Не_требовать_подписанта_в_ОРД** - отключает проверку в ОРД на наличие этапа с подписанием.

## Поручения

[«Поручения»](https://ecm-user-manuals.readthedocs.io/ru/latest/User manuals/%D0%9F%D0%BE%D1%80%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5/) – это документ, в котором одному или нескольким сотрудникам организации ставится задача достичь определенного результата к заданному сроку.
Для поручений имеются необходимые роли:

Роль | Описание
-----|---------
**instruction_read**  |  для просмотра и ознакомления с документом.
**instruction_write**  |  для редактирования данной формы.
  
Имеются константы:

- **поручение инициатор=контролер** – в документе "Поручение" поле контролер автоматически заполняется значением из поля "Составитель".
  
- **instruction_with_signature** – чтобы в реестре документа «Поручение» добавляется колонка с признаком подписания ЭП и изменяется печатная форма документа на шаблон со штампом электронной подписи
  
## Служебные записки

Служебные записки – это документ служащий для автоматизации документооборота служебных записок в организации. Подробнее с данной формой можно ознакомиться в разделе [«Служебные записки»](https://ecm-user-manuals.readthedocs.io/ru/latest/User manuals/%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F %D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%BA%D0%B0/)

В служебных записках имеются технические роли для работы с формой документа:

Роль | Описание
-----|---------
**servicerecord_read**  |  дает возможность чтения и ознакомления формы.
**servicerecord_write**  |  дает право редактирования документа.
**docconstructor_write**  |  открывает доступ к переходу в конструктор документа по данному типу/подтипу документа.
**routetemplate_write**  |  открывает доступ к переходу в настройки шаблона маршрута по данному документу.
**documentsubtype_write**  |  открывает доступ к переходу в настройки подтипа документа.

В служебных записках имеется 2 константы: 

- **servicerecord_with_signature** – чтобы в реестре документов «Служебная записка» и «ОРД» добавляется колонка с признаком подписания ЭП и изменяется печатная форма документа на шаблон со штампом электронной подписи.
  
- **СЗ печать старой формы отчета до** – отображает статичную печатную форму служебной записки. Возможно динамическое изменение печатной формы с помощью вычисляемых атрибутов
  
У служебных записок имеются сервисные функции, которые автоматически редактируют документ по заданным условиям. Так в служебных записках присутствуют такое сервисные функции как:

- **Service.ListOf.AgreementUsers** – автоматически определяет дополнительного согласованта в служебных записках  
  
- **Service.ListOf.Recipient** – автоматически определяет получателя (-ей) служебной записки из "Кому".
  
- **Service.Recipient** – автоматически определяет получателя служебной записки из "Кому".
  
- **Service.Signer** – автоматически определяет подписанта в служебных записках.
  
Так же если поставить служебное слово **Service.Signer** в шаблоне маршрутов то по этому слову будет подставляться пользователь выбранный из выпадающего списка "Подписант". К примеру:

![Рисунок](media/shablon_marshruta.png)

По шаблону данного маршрута можно убедиться в правильности заполнения сервисных функций в маршруте. А именно чтобы в маршрут вставали все кто указан в карточке в следующих табличных частях: Подписант, Кому, Копия и Доп. Согласование.

По умолчанию в поле подписанта встает руководитель инициатора документа, указанный в настройках пользователя. Подробнее с формой можно ознакомиться в инструкции [«настройки пользователя»](https://ecm-administrator-manuals.readthedocs.io/ru/latest/Admin manuals/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0 %D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9/).

Но если у инициатора документа стоит галочка «Право подписи», то по умолчанию инициатор становиться подписантом. Например:

![Рисунок](media/pravo_podpisi.png)

На скрине видно что в поле «Руководитель» указана Абдуллаева А.Н. Если в поле «право подписи» поставить галочку то в поле подписан встанет Admin, так как страница авторизована под Админом

![Рисунок](media/image.png)

### Загрузить из Excel

Внутри служебной записки возможна загрузка данных из таблицы excel в табличную часть, подробнее можно ознакомиться по [ссылке](https://ecm-user-manuals.readthedocs.io/ru/latest/User manuals/%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F %D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%BA%D0%B0/#%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C_%D0%B8%D0%B7_excel).

1) В конструкторе документов должна быть настроена верная нумерация для атрибутов иначе корректной вставки значений в табличную часть не произойдет:

![alt text](media/image-2.png)

2) Для выпадающих списков заполняется столбец "Код". **Если заполнить столбец "Наименование" текстовыми значениями то вставка в табличную часть в документа не сработает.**

![alt text](media/image-1.png)

Для типов атрибутов **"Работник", "Должность", "Подразделение"** рекомендуется использовать [вычисления](../Конструктор документов/#вкладка_настройка_вычислений) с помощью конструктора. Для примера в конструкторе документов создается атрибут "Строка" с наименованием **"Табельный номер"**:

Служебное наименование таблицы | Наименование | Тип атрибута | Служебное наименование
-------------------------------|--------------|--------------|-----------------------
#Table1# | Работник | Работник | #worker#
#Table1# | Табельный номер | Строка | #worker_tabn#
#Table1# | Должность | Должность | #worker_post#

И настроить следующие вычисления:

Основной атрибут | Зависимые атрибуты | Вычисления
-----------------|--------------------|-----------
#Table1_worker# | #Table1_worker_tabn# | (select "NumTab" from rp."RP_Worker" where "VCode" = #Table1_worker#)
#Table1_worker# | #Table1_worker_post# | (select rpwm."IdPost" from rp."RP_Worker" w join rp."RP_WorkerMove" rpwm on rpwm."IdWorker" =  w."VCode" where w."VCode" =  #Table1_worker#  and w."NumTab" = #Table1_worker_tabn# order by coalesce(rpwm."DateEnd",'20700101') desc limit 1 )
#Table1_worker_tabn# | #Table1_worker# | (select "VCode" from rp."RP_Worker" where "NumTab" = #Table1_worker_tabn# order by coalesce("DateEnd",'20700101'::date) desc limit 1)

В этом случае пользователю будет достаточно заполнить столбец "Табельный номер", а остальные атрибуты будут заполнены автоматически.

Для корректной вставки данных из excel в табличную часть рекомендуется используются следующие правила заполнения атрибутов:

Тип атрибута | Заполнение
-------------|-----------------------
Произвольная выборка | Заполняется столбец "Код"
Контрагент | Заполняется столбец "Код"
Работник | Заполняется столбец "Код"
Подразделение | Заполняется столбец "Код"
Должность | Заполняется столбец "Код"
Пользовательский тип атрибута | Заполняется столбец "Код"
Договор | Заполняется столбец "Код"
Дата | 01.01.2000
Дата и время | 01.01.2000 0:00
Время | 0:00
Логическое | true - установлена галочка