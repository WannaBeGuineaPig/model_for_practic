# Обмен данными с 1С

## Выгрузка документов из 1С

Для автоматического обмена данными с 1С разработаны следующие функции для [Планировщика задач](../../Планировщик задач/) :<br>

![Рисунок 10 Задачи шедуллера](./media/Задачи шедуллера.PNG) <br>

В системе возможно настроить отображение данной задачи в панели виджетов. Для этого пользователю необходимо предоставить роль **Интеграция с 1С**:![Alt text](media/image-1.png)

Для ручного обмена данными с 1С предназначен документ «Обмен данными с 1С».<br>
![Рисунок 1 Обмен_данными_с_1С](./media/Обмен_данными_с_1С.png) <br>

Документ разделен на закладки по типу данных для обмена:<br>
•	Справочники<br>
•	Сотрудники<br>
•	Документы из СЭД<br>
•	Документы для загрузки в СЭД <br>
•	Обработанные документы на подписание <br>
•	Документы из 1С для создания в Лексеме<br>

На каждой из закладок порядок действий примерно одинаков – необходимо выгрузить данные, предлагаемые системой, отметить все документы либо выбрать только нужные и загрузить выбранные данные.<br>
 
![Рисунок 2 Схема1](./media/Схема1.png) <br>

* В случае, если из 1С инициируется создание двух документов в СЭД, данные будут загружены в Документ на подписание и Универсальный документ (согласие).   Например, Приказ на работу в выходной день, как документ на подписание проходит в СЭД по маршруту согласования, а также порождает для участников приказа Универсальный документ на согласие на работу в выходной день.<br>
  
![Рисунок 3 Схема2](./media/Схема2.png) <br>

Ниже представлена таблица с описанием типовых потоков обмена данными:<br>

Название документа для обмена | Сущность 1С | Документ-источник данных\Откуда берем данные | Документ-принимающая сторона\Куда данные поступают
------------------------------|-------------|----------------------------------------------|---------------------------------------------------
Трудовой договор | ПриемНаРаботу | 1C:ЗУП/Прием на работу/Трудовой договор - присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Трудовой договор
Приказ о приеме на работу | ПриемНаРаботу | 1C:ЗУП/ПриемНаРаботу/Приказ о приеме на работу - присоединенный файл печатной формы | Lexema-ECM/Документ на подписание/Приказ о приеме
Сведения об электронном листке нетрудоспособности | Document_БольничныйЛист | Lexema-ECM/Заявления от сотрудников/Сведения об электронном листке нетрудоспособности | 1C:ЗУП/Больничный лист
Заявление на предоставление отпуска по беременности и родам | Document_БольничныйЛист | Lexema-ECM/Заявления от сотрудников/Заявление на предоставление отпуска по беременности и родам | 1C:ЗУП/Больничный лист
Приказ о предоставлении отпуска по беременности и родам | Document_БольничныйЛист | 1C:ЗУП/Больничный лист/Приказ о предоставлении отпуска-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ о предоставлении отпуска по беременности и родам
Заявление на предоставление отпуска без сохранения заработной платы | Document_ОтпускБезСохраненияОплаты | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление отпуска без сохранения заработной платы | 1C:ЗУП/Отпуск без сохранения оплаты
Приказ на предоставление отпуска без сохранения заработной платы | Document_ОтпускБезСохраненияОплаты | 1C:ЗУП/Отпуск без сохранения оплаты | Lexema-ECM/Документ на подисание/Приказ на предоставление отпуска без сохранения заработной платы
Заявление на предоставление ежегодного основного оплачиваемого отпуска | Document_Отпуск | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление ежегодного отпуска | 1C:ЗУП/Отпуск
Заявление о предоставлении ежегодного основного оплачиваемого отпуска с последующим увольнением | Document_Отпуск | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление ежегодного отпуска | 1C:ЗУП/Отпуск
Приказ о предоставлении ежегодного основного оплачиваемого отпуска | Document_Отпуск | 1C:ЗУП/Отпуск-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ на отпуск
Заявление на предоставление дополнительного отпуска | Document_Отпуск | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставлении дополнительного отпуска | 1C:ЗУП/Отпуск
Заявление на замену части дополнительного отпуска денежной компенсацией | Document_Отпуск | Lexema-ECM/Заявления от сотрудников/ Заявление на замену части дополнительного отпуска денежной компенсацией | 1C:ЗУП/Отпуск
Приказ о компенсации отпуска | Document_Отпуск | 1C:ЗУП/Отпуск-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ о компенсации отпуска
Заявление о переносе ежегодного основного оплачиваемого отпуска, запланированного по графику отпусков | Document_ПереносОтпуска | Lexema-ECM/Заявление о переносе ежегодного основного оплачиваемого отпуска, запланированного по графику отпусков | 1C:ЗУП/Перенос отпуска
Заявление о переносе предоставленного ежегодного основного оплачиваемого отпуска в связи с пересечением с больничным листом  | Document_ПереносОтпуска | Lexema-ECM/Заявление о переносе предоставленного ежегодного основного оплачиваемого отпуска | 1C:ЗУП/Перенос отпуска
Приказ о переносе отпуска | Document_ПереносОтпуска | 1C:ЗУП/Перенос отпуска | Lexema-ECM/Документ на подисание/Приказ о переносе отпуска
Заявление на предоставление учебного отпуска | Document_Отпуск | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление учебного отпуска | 1C:ЗУП/Отпуск
Приказ о предоставлении учебного отпуска | Document_Отпуск | 1C:ЗУП/Отпуск-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ на отпуск
Заявление о предоставлении дополнительных дней отдыха в связи со сдачей крови | Document_ПрогулНеявка | Lexema-ECM/Заявления от сотрудников/ Заявление о предоставлении дополнительных дней отдыха в связи со сдачей крови | 1C:ЗУП/Отсутствия (болезни, прогулы, неявки)
Заявление на предоставление дополнительных оплачиваемых выходных дней для ухода за детьми-инвалидами | Document_ПрогулНеявка | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление дополнительных оплачиваемых выходных дней для ухода за детьми-инвалидами | 1C:ЗУП/Отсутствия (болезни, прогулы, неявки)
Приказ о предоставлении нерабочего времени с сохранением среднего заработка | Document_ПрогулНеявка | 1C:ЗУП/Отсутствия (болезни, прогулы, неявки)-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ о неявке
Заявление на предоставление отпуска по уходу за ребенком до достижения им возраста трех лет с начислением и выплатой ежемесячного пособия по уходу за ребенком до полутора лет | ОтпускПоУходуЗаРебенком  | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление отпуска по уходу за ребенком до достижения им возраста трех лет с начислением и выплатой ежемесячного пособия по уходу за ребенком до полутора лет | 1C:ЗУП/Отпуска по уходу и возвраты из отпуска
Приказ о предоставлении отпуска по уходу за ребенком до достижения им возраста с выплатой ежемесячного пособия по уходу за ребенком до полутора лет | ОтпускПоУходуЗаРебенком  | 1C:ЗУП/Отпуска по уходу и возвраты из отпуска-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ о предоставлении отпуска по уходу за ребенком
Заявление о досрочном прекращении отпуска по уходу за ребенком до 3 лет | ВозвратИзОтпускаПоУходуЗаРебенком | Lexema-ECM/Заявления от сотрудников/ Заявление о досрочном прекращении отпуска по уходу за ребенком до 3 лет | 1C:ЗУП/Отпуска по уходу и возвраты из отпуска
Приказ о выходе на работу до окончания отпуска по уходу за ребенком | ВозвратИзОтпускаПоУходуЗаРебенком | 1C:ЗУП/Отпуска по уходу и возвраты из отпуска-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ о прекращении отпуска по уходу за ребенком
Служебная записка о направлении работника в командировку | КомандировкиСотрудников | Lexema-ECM/Служебная записка о направлении работника в командировку | 1C:ЗУП/Командировки
Приказ о направлении в командировку | КомандировкиСотрудников | 1C:ЗУП/Командировки-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Приказ на командировку
Заявление о выплате материальной помощи | МатериальнаяПомощь | Lexema-ECM/Заявления от сотрудников/ Заявление о выплате материальной помощи | 1C:ЗУП/Материальная помощь
Приказ о выплате материальной помощи | МатериальнаяПомощь | 1C:ЗУП/Материальная помощь-присоединенный файл печатной формы | Lexema-ECM/Приказ о выплате материальной помощи
Заявление на предоставление Справки 2-НДФЛ | Document_СправкаНДФЛ | Lexema-ECM/Заявления от сотрудников/ Заявление на предоставление Справки 2-НДФЛ | 1C:ЗУП/Справка 2 НДФЛ для сотрудников
Справка 2-НДФЛ | Document_СправкаНДФЛ | 1C:ЗУП/Справка 2 НДФЛ для сотрудников-присоединенный файл печатной формы | Lexema-ECM/Справка 2 НДФЛ
Табель учета рабочего времени | ТабельУчетаРабочегоВремени | 1C:ЗУП/Табели-присоединенный файл печатной формы | Lexema-ECM/Документ на подисание/Табель учета рабочего времени
График отпусков | ГрафикОтпусков | 1C:ЗУП/График отпусков | Lexema-ECM/График отпусков
Заявление о предоставлении стандартного налогового вычета на ребенка | Document_ЗаявлениеНаПредоставлениеСтандартныхВычетовПоНДФЛ | Lexema-ECM/Заявление о предоставлении стандартного налогового вычета на ребенка | 1C:ЗУП/Заявление на предоставление стандартных вычетов по НДФЛ
Заявление на выплату единовременного пособия в связи с рождением ребенка | ЗаявлениеСотрудникаНаВыплатуПособия | Lexema-ECM/Заявление на выплату единовременного пособия в связи с рождением ребенка | 1C:ЗУП/Реестры сведений для ФСС
Заявление о выплате пособия на погребение | ЗаявлениеВФССОВозмещенииРасходовНаПогребение | Lexema-ECM/Заявление о выплате пособия на погребение | 1C:ЗУП/Реестры сведений для ФСС
Заявление об изменении графика работы по инициативе работника | Document_ИзменениеГрафикаРаботыСписком | Lexema-ECM/Заявление об изменении графика работы по инициативе работника | 1C:ЗУП/Изменение графика работы списком
Приказ об изменении графика работы | Document_ИзменениеГрафикаРаботыСписком | 1C:ЗУП/Изменение графика работы списком | Lexema-ECM/Документ на подисание/Приказ об изменении графика работы
Заявление на перевод | Document_КадровыйПеревод | Lexema-ECM/Заявление на перевод | 1C:ЗУП/Кадровый перевод
Приказ о переводе | Document_КадровыйПеревод | 1C:ЗУП/Кадровый перевод | Lexema-ECM/Документ на подисание/Приказ о переводе <br>

**Основная часть потоков, изображенная на рисунке 1 происходит следующим образом:**<br>
Сотрудник оформляет документ в СЭД  "Заявление от сотрудника", документ проходит маршрут согласования, по завершении маршрута документ считается готовым для передачи в 1С.<br>

В 1С поступает документ в виде предзаполненной карточки документа. К документу в 1С необходимо вложить печатную форму в  присоединенные файлы, степень готовности к получению документа в СЭД определяется по полям **Параметр**, например, **{"ДокументПроведен": true}**, а также *Наименование отчета в 1С*, например, *Приказ о предоставлении отпуска*. Если же данные параметры не будут указаны, любой документ указанной сущности будет принят СЭД как готовый к загрузке.<br>
 
Таким образом, *Документ на подписание* с подтипом *Приказ о предоставлении отпуска* будет загружен в СЭД, в случае, если *документ проведен* и к карточке документа *присоединен файл*, название которого начинается со слов "Приказ о предоставлении отпуска..." <br>

После прохождения этапов согласования, из документа на подписание, печатная форма документа передается обратно в 1С.<br>
Из документа с законченным маршрутом может быть выгружен архив документа - печатная форма и файлы подписей, такой набор файлов позволяет использовать документ вне системы как юридически легитимный.<br>

**Загрузка документа СЭД со всеми атрибутами из 1С, изображенная на рисунке 2,** <br>
происходит только в одном направлении - из 1С в СЭД. Критерии готовности документа определяются также, как по документам на подписание - по полям Параметр, а также Наименование отчета в 1С. <br>
Например, График отпусков, при параметрах Наименование отчета в 1С='Форма Т-7', будет считаться готовым к загрузке, при наличии в присоединенных файлах документа, название которого начинается со слов "Форма Т-7".<br>

## Выгрузка расчетных листов в систему

* Для настройки выгрузки расчетных листов необходимо специалистам со стороны Заказчика необходимо определить определенную сетевую папку на сервере и настроить автоматическую выгрузку отчетных документов из системы 1С в данную сетевую папку.

!!! warning
    На каждого сотрудника должен быть свой отчетный документ. Название данного документа должно соответствовать следующему шаблону: Наименование отчетного месяца словами , год, наименование организации, ФИО, табельный номер. 

    Пример: АПРЕЛЬ 2023, Радуга ООО,Смирнов Александр Александрович (0000-00035)

    ![Alt text](media/image-1.png)

* Специалистам Лексемы необходимо необходимо в конфигурационном файле проекта в директории `odata/connections/инстанция1С` добавить объект smb с параметрами коннекта к сетевой папке для соответствующей инстанции 1С

``` SQL
odata: {
        connections: {
          "1С ЗУП": {
            "login": "test1c",
            "password": "******",
            "path": "http://server1c.lex.lan/DemoHRM/odata/standard.odata/",
            "type": 'ODATA',
            smb : {
              share: '\\\\192.168.250.196\\РасчетныеЛисты',
              domain: 'WORKGROUP',
              username: '******',
              password: '******',
              folder: 'РассылкаЛистков'
            }
          }
```

```
share - путь к сетевому каталогу
domain - домен или рабочая группа
username - пользователь, у которого есть права на чтение для сетевого каталога
password - пароль пользователя
folder - папка внутри сетевого каталога, в которой лежат файлы (PDF-ки расчетных листов)
```

* Для документа на подписание добавить [подтип](../../Подтипы документов/) Расчетный Лист.

* В [настроечную](../Настройка интеграции справочников и документов/Вкладка Входящие документы/) таблицу для обмена с 1С на закладке "Входящие документы" добавить строку с этим подтипом, в столбце "Наименование документа" указать **РасчетныйЛист**, столбец "Сущность в 1С" оставить с пустым значением.

![Alt text](media/image-2.png)

* Настроить задачу [планировщика](../../Планировщик задач/index.md)["Загрузка в Лексему документов на подписание из файлов (расчетные листы)"](../../Функции планировщика задач/index.md)